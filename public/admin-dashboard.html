<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard | AGC Teens</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { font-family: sans-serif; background: #f8f8f8; margin: 0; padding: 20px; }
    h1 { text-align: center; color: #006666; }
    .section { background: #fff; margin: 20px auto; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); max-width: 900px; }
    .section h2 { margin-top: 0; cursor: pointer; }
    .panel { display: none; margin-top: 10px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    table, th, td { border: 1px solid #ddd; }
    th, td { padding: 8px; text-align: left; }
    input, textarea, select { width: 100%; padding: 8px; margin: 8px 0; border-radius: 4px; border: 1px solid #ccc; }
    button { padding: 10px 15px; background: #006666; color: #fff; border: none; border-radius: 5px; cursor: pointer; }
    .media-preview { margin: 10px 0; }
  </style>
</head>
<body>
  <h1>AGC Teens Admin Dashboard</h1>

  <div class="section">
    <h2 onclick="togglePanel(this)">üìã RSVPs</h2>
    <div class="panel" id="rsvpList"></div>
  </div>

  <div class="section">
    <h2 onclick="togglePanel(this)">üôè Prayer Requests</h2>
    <div class="panel" id="prayerList"></div>
  </div>

  <div class="section">
    <h2 onclick="togglePanel(this)">üì¨ Newsletter Subscribers</h2>
    <div class="panel" id="subscriberList"></div>
  </div>

  <div class="section">
    <h2 onclick="togglePanel(this)">üñº Media Upload</h2>
    <div class="panel">
      <form id="mediaForm">
        <input type="file" name="file" required>
        <select name="type">
          <option value="image">Image</option>
          <option value="video">Video</option>
          <option value="audio">Audio</option>
        </select>
        <button type="submit">Upload</button>
      </form>
      <div id="mediaList"></div>
    </div>
  </div>

  <div class="section">
    <h2 onclick="togglePanel(this)">üì∞ Blog/News</h2>
    <div class="panel">
      <form id="blogForm">
        <input type="text" name="title" placeholder="Title" required>
        <textarea name="content" placeholder="Content" rows="4" required></textarea>
        <button type="submit">Post</button>
      </form>
      <div id="blogList"></div>
    </div>
  </div>

  <script>
    // dashboard.js (for dashboard.html)
const token = localStorage.getItem("adminToken");
if (!token) window.location.href = "admin-login.html";

const headers = {
  Authorization: token,
  "Content-Type": "application/json"
};

function togglePanel(header) {
  const panel = header.nextElementSibling;
  panel.style.display = panel.style.display === "block" ? "none" : "block";
}

// === RSVPs ===
async function loadRSVPs() {
  const res = await fetch("/api/rsvp", { headers });
  const data = await res.json();
  const html = data.map(d => `<tr><td>${d.name}</td><td>${d.email}</td></tr>`).join("");
  document.getElementById("rsvpList").innerHTML = `<table><tr><th>Name</th><th>Email</th></tr>${html}</table>`;
}

// === Prayers ===
async function loadPrayers() {
  const res = await fetch("/api/prayers", { headers });
  const data = await res.json();
  const html = data.map(d => `<tr><td>${d.name}</td><td>${d.email}</td><td>${d.content}</td></tr>`).join("");
  document.getElementById("prayerList").innerHTML = `<table><tr><th>Name</th><th>Email</th><th>Prayer</th></tr>${html}</table>`;
}

// === Subscribers ===
async function loadSubscribers() {
  const res = await fetch("/api/subscribers", { headers });
  const data = await res.json();
  const html = data.map(d => `<tr><td>${d.email}</td></tr>`).join("");
  document.getElementById("subscriberList").innerHTML = `<table><tr><th>Email</th></tr>${html}</table>`;
}

// === Media ===
document.getElementById("mediaForm").addEventListener("submit", async e => {
  e.preventDefault();
  const form = e.target;
  const formData = new FormData(form);
  const res = await fetch("/api/media", {
    method: "POST",
    headers: { Authorization: token },
    body: formData
  });
  form.reset();
  loadMedia();
});

async function loadMedia() {
  const res = await fetch("/api/media", { headers });
  const media = await res.json();
  document.getElementById("mediaList").innerHTML = media.map(m => {
    const preview = m.type === "image" ? `<img src="${m.url}" width="100">` : m.type === "video" ? `<video src="${m.url}" width="160" controls></video>` : `<audio src="${m.url}" controls></audio>`;
    return `<div class="media-preview">${preview}<br><button onclick="deleteMedia('${m._id}')">Delete</button></div>`;
  }).join("");
}

async function deleteMedia(id) {
  await fetch(`/api/media/${id}`, {
    method: "DELETE",
    headers: { Authorization: token }
  });
  loadMedia();
}

// === Blogs ===
document.getElementById("blogForm").addEventListener("submit", async e => {
  e.preventDefault();
  const form = e.target;
  const blog = {
    title: form.title.value,
    content: form.content.value
  };
  await fetch("/api/blogs", {
    method: "POST",
    headers,
    body: JSON.stringify(blog)
  });
  form.reset();
  loadBlogs();
});

async function loadBlogs() {
  const res = await fetch("/api/blogs", { headers });
  const blogs = await res.json();
  document.getElementById("blogList").innerHTML = blogs.map(b => `
    <div style="margin-top:10px">
      <strong>${b.title}</strong>
      <p>${b.content}</p>
      <button onclick="deleteBlog('${b._id}')">Delete</button>
    </div>
  `).join("");
}

async function deleteBlog(id) {
  await fetch(`/api/blogs/${id}`, {
    method: "DELETE",
    headers
  });
  loadBlogs();
}

// === Load all data on page load ===
window.onload = function () {
  loadRSVPs();
  loadPrayers();
  loadSubscribers();
  loadMedia();
  loadBlogs();
};

  </script>
</body>
</html>
